/*! ArtemisJs 2013-12-31 */
!function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a.artemis=b()}(this,function(){function a(){var a=32,b=5,c=[],d=function(a){return a>>b},e=function(a){return 1<<(31&a)},f=function(){return c},g=function(a){if(!(0>a)){var b=d(a);return c[b]=c[b]|e(a),c[b]}},h=function(a){if(!(0>a)){var b=d(a);return c[b]=c[b]&~e(a),c[b]}},i=function(a){if(0>a)return void 0;var b=d(a);return c[b]&e(a)},j=function(){return c.length},k=function(){var a,b=0;for(a=0;a<c.length;a+=1)for(var d=c[a]||0,e=d;0!==e;e&=e-1)b+=1;return b},l=function(a){if(this===a)return this;var b,d=Math.min(j(),a.maxWords()),e=a.getWords();for(b=0;d>b;b+=1)c[b]=(c[b]||0)|(e[b]||0);return d<a.maxWords()&&(c=c.concat(e.slice(d,a.maxWords()))),this},m=function(a){if(this===a)return this;var b,d=Math.min(j(),a.maxWords()),e=a.getWords();for(b=0;d>b;b+=1)c[b]=(c[b]||0)&(e[b]||0);if(d>a.maxWords()){for(var f=Math.max(Math.ceil(a.maxWords()-d),0),g=0,h=new Array(f);f>g;)h[g++]=d,d+=1;for(var i=0;i<h.length;i++)c.pop()}return this},n=function(a){var b,d=Math.min(j(),a.maxWords()),e=a.getWords();for(b=0;d>b;b+=1)c[b]=(c[b]||0)^(e[b]||0);var f;if(d<a.maxWords())for(f=a.maxWords(),b=d;f>b;b+=1)c[b]=0^(e[b]||0);else for(f=j(),b=d;f>b;b+=1)c[b]=0^(c[b]||0);return this},o=function(f){var g=d(f);if(g>=c.length)return-1;var h,i=c[g],k=j();if(i)for(h=31&f;a>h;h+=1)if(i&e(h))return(g<<b)+h;for(g+=1;k>g;g+=1){var l=c[g];if(l)for(h=0;a>h;h+=1)if(0!==(l&e(h)))return(g<<b)+h}return-1},p=function(f){var g=d(f);if(g>=c.length)return-1;var h,i=c[g];if(i)for(h=31&f;h>=0;h-=1)if(i&e(h))return(g<<b)+h;for(g-=1;g>=0;g-=1){var j=c[g];if(j)for(h=a-1;h>=0;h-=1)if(0!==(j&e(h)))return(g<<b)+h}return-1},q=function(a){a=a||10;for(var b=[],d=0;d<c.length;d++)b.push((c[d]||0).toString(a));return"["+b.join(", ")+"]"},r=function(a){for(var b=Math.min(j(),a.maxWords())-1;b>=0;b--)if(c[b]&a.getWords()[b])return!0;return!1},s=function(){return 0===c.length};return{getWords:f,set:g,get:i,clear:h,maxWords:j,cardinality:k,or:l,and:m,xor:n,nextSetBit:o,prevSetBit:p,intersects:r,isEmpty:s,toString:q}}function b(){var a,b,c="";for(a=0;32>a;a++)b=16*Math.random()|0,(8==a||12==a||16==a||20==a)&&(c+="-"),c+=(12==a?4:16==a?3&b|8:b).toString(16);return c}var c=function(){function b(){var a={};return c.call(a),a}var c=function(){function b(a,b){for(var c=0;c<b.length;c++)a.set(h.getIndexFor(b[c]))}var c=a(),d=a(),e=a();this.getAllSet=function(){return c},this.getExclusionSet=function(){return d},this.getOneSet=function(){return e},this.all=function(){return b(c,arguments),this},this.exclude=function(){return b(d,arguments),this},this.one=function(){return b(e,arguments),this}};return{getAspectForAll:function(){var a=b();return a.all.apply(a,arguments),a},getAspectForOne:function(){var a=b();return a.one.apply(a,arguments),a},getEmpty:function(){return b()}}}(),d=Object.create(Object.prototype);Object.defineProperty(d,"extend",{value:function(){for(var a=Object.hasOwnProperty,b=Object.create(this),c=arguments.length,d=c;d;){var e=arguments[c-d--];for(var f in e)(a.call(e,f)||"undefined"==typeof b[f])&&(b[f]=e[f])}return b},configurable:!1,enumerable:!1,writable:!0});var e=d.extend({create:function(){return Object.create(this)}});Object.defineProperty(e,"componentType",{value:"component",configurable:!0,enumerable:!1,writable:!1});var f=function(){var a=function(){function a(a){for(var c=a.getComponentBits(),d=c.nextSetBit(0);d>=0;d=c.nextSetBit(d+1))b.get(d).set(a.getId(),null);c.clear()}var b=x(),c=x();this.addComponent=function(a,b,c){var d=this.getComponentsByType(b);d.set(a.getId(),c),a.getComponentBits().set(b.getIndex())},this.removeComponent=function(a,c){var d=a.getComponentBits();d.get(c.getIndex())&&(b.get(c.getIndex()).set(a.getId(),null),d.clear(c.getIndex()))},this.getComponentsByType=function(a){var c=b.get(a.getIndex());return c||(c=x(),b.set(a.getIndex(),c)),c},this.getComponent=function(a,c){var d=b.get(c.getIndex());return d?d.get(a.getId()):null},this.getComponentsFor=function(a,c){for(var d=a.getComponentBits(),e=d.nextSetBit(0);e>=0;e=d.nextSetBit(e+1))c.add(b.get(e).get(a.getId()));return c},this.deleted=function(a){c.add(a)},this.clean=function(){if(c.size()>0){for(var b=0;c.size()>b;b++)a(c.get(b));c.clear()}}},b=m.extendManager(n,"componentManager",{create:function(){var b=Object.create(this);return a.call(b),b}});return b}(),g=function(){var a=function(a,b){var c=h.getTypeFor(a),d=b.getComponentManager().getComponentsByType(c);this.get=function(a){return d.get(a.getId())},this.getSafe=function(a){return d.isIndexWithinBounds(a.getId())?d.get(a.getId()):null},this.has=function(a){return d.isIndexWithinBounds(a.getId())}};return{getFor:function(b,c){var d={};return a.call(d,b,c),d}}}(),h=function(){function a(){var a=b++;return{getIndex:function(){return a}}}var b=0,c=Object.create(null);return{getTypeFor:function(b){var d=c[b];return d||(d=a(),c[b]=d),d},getIndexFor:function(a){return this.getTypeFor(a).getIndex()}}}(),i=function(){var c=function(c,d){var e,f=a(),g=a(),i=c.getEntityManager(),j=c.getComponentManager();this.reset=function(){f.clear(),g.clear(),e=b()},this.getId=function(){return d},this.getComponentBits=function(){return f},this.getSystemBits=function(){return g},this.getUuid=function(){return e},this.getWorld=function(){return c},this.addComponent=function(a,b){var c=b;return c||(c=h.getTypeFor(a.componentType)),j.addComponent(this,c,a),this},this.removeComponent=function(a){return this.removeComponentByType(a.componentType)},this.removeComponentByType=function(a){var b=a;return"string"==typeof b&&(b=h.getTypeFor(b)),j.removeComponent(this,b),this},this.isActive=function(){return i.isActive(d)},this.isEnabled=function(){return i.isEnabled(d)},this.getComponent=function(a){var b=a;return"string"==typeof b&&(b=h.getTypeFor(b)),j.getComponent(this,b)},this.getComponents=function(a){return j.getComponentsFor(this,a)},this.addToWorld=function(){c.addEntity(this)},this.changedInWorld=function(){c.changedEntity(this)},this.deleteFromWorld=function(){c.deleteEntity(this)},this.enable=function(){c.enable(this)},this.disable=function(){c.disable(this)}},d={create:function(a,b){var d=Object.create(this);return c.call(d,a,b),d.reset(),d}};return d}(),j=function(){var b=function(){var a=x(),b=0;return{checkOut:function(){return a.size()>0?a.removeLast():b++},checkIn:function(b){a.add(b)}}},c=function(){var c=x(),d=a(),e=0,f=0,g=0,h=0,j=b();this.createEntityInstance=function(){var a=i.create(this.getWorld(),j.checkOut());return g++,a},this.added=function(a){e++,f++,c.set(a.getId(),a)},this.enabled=function(a){d.clear(a.getId())},this.disabled=function(a){d.set(a.getId())},this.deleted=function(a){c.set(a.getId(),null),d.clear(a.getId()),j.checkIn(a.getId()),e--,h++},this.isActive=function(a){return c.get(a)?!0:!1},this.isEnabled=function(a){return!d.get(a)},this.getEntity=function(a){return c.get(a)},this.getActiveEntityCount=function(){return e},this.getTotalCreated=function(){return g},this.getTotalAdded=function(){return f},this.getTotalDeleted=function(){return h}},d=m.extendManager(n,"entityManager",{create:function(){var a=Object.create(this);return c.call(a),a}});return d}(),k=d.extend({added:function(){},changed:function(){},deleted:function(){},enabled:function(){},disabled:function(){}}),l=function(){var a=function(){var a=0,b=Object.create(null);return{getIndexFor:function(c){if(!c)return-1;var d=b[c];return d||(d=a++,b[c]=d),d}}}(),b=function(b){function c(){this.checkProcessing()&&(this.begin(),this.processEntities(j),this.end())}function d(a){j.removeElement(a),a.getSystemBits().clear(i),this.removed(a)}function e(a){j.add(a),a.getSystemBits().set(i),this.inserted(a)}function f(a){if(!n){var b=a.getSystemBits().get(i),c=!0,f=a.getComponentBits();if(!k.isEmpty())for(var g=k.nextSetBit(0);g>=0;g=k.nextSetBit(g+1))if(!f.get(g)){c=!1;break}!l.isEmpty()&&c&&(c=!l.intersects(f)),m.isEmpty()||(c=m.intersects(f)),c&&!b?e.call(this,a):!c&&b&&d.call(this,a)}}function g(a){a.getSystemBits().get(i)&&d.call(this,a)}var h,i=a.getIndexFor(this.systemType),j=x(),k=b.getAllSet(),l=b.getExclusionSet(),m=b.getOneSet(),n=k.isEmpty()&&m.isEmpty(),o=!1;this.isPassive=function(){return o},this.setPassive=function(a){o=a},this.getActives=function(){return j},this.process=c,this.check=f,this.added=f,this.changed=f,this.deleted=g,this.disabled=g,this.enabled=f,this.setWorld=function(a){h=a},this.getWorld=function(){return h}},c=m.extendSystem(d,"entitySystem",k,{create:function(a){var c=Object.create(this);return b.call(c,a),c},inserted:function(){},removed:function(){},initialize:function(){},begin:function(){},end:function(){},checkProcessing:function(){return!1},processEntities:function(){throw{NotImplemented:"Not supported yet. Override processEntities when extending"}}});return c}(),m=function(){function a(a,b){var c=Array.prototype.slice.call(arguments,2),d=a.extend.apply(a,c);return Object.defineProperty(d,b.name,{value:b.value,configurable:!0,enumerable:!1,writable:!1}),d}return{extendSystem:function(b,c){var d=[];d.length=arguments.length,d[0]=arguments[0],d[1]={name:"systemType",value:c};for(var e=2;e<arguments.length;e++)d.push(arguments[e]);return a.apply(null,d)},extendManager:function(b,c){var d=[];d.length=arguments.length,d[0]=arguments[0],d[1]={name:"managerType",value:c};for(var e=2;e<arguments.length;e++)d.push(arguments[e]);return a.apply(null,arguments)},extendComponent:function(b,c){var d=[];d.length=arguments.length;var e=2;"string"==typeof b?(d[0]=d8.component,d[1]={name:"componentType",value:b},e=1):(d[0]=b,d[1]={name:"componentType",value:c});for(var f=e;f<arguments.length;f++)arguments[f]&&d.push(arguments[f]);return a.apply(null,d)}}}(),n=d.extend(k,{initialize:function(){},setWorld:function(a){this.world=a},getWorld:function(){return this.world}});Object.defineProperty(n,"managerType",{value:"manager",configurable:!0,enumerable:!1,writable:!1});var o=function(){var a=function(){function a(a){var b=d[a.getUuid()];if(b){for(var e,f=0;f<b.size();f++)e=c[b.get(f)],e&&e.removeElement(a);b.clear()}}function b(a){var b=d[a.getUuid()];return b&&!b.isEmpty()}var c=Object.create(null),d=Object.create(null);this.add=function(a,b){var e=c[b];e||(e=x(),c[b]=e),e.add(a);var f=d[a.getUuid()];f||(f=x(),d[a.getUuid()]=f),f.add(b)},this.remove=function(a,b){var e=c[b];e&&e.removeElement(a);var f=d[a.getUuid()];f&&f.removeElement(b)},this.removeFromAllGroups=a,this.getEntities=function(a){var b=c[a];return b||(b=x(),c[a]=b),b},this.getGroups=function(a){return b(a)?d[a.getUuid()]:null},this.isInAnyGroup=b,this.isInGroup=function(a,b){var c=d[a.getUuid()];return c&&c.contains(b)},this.deleted=function(b){a(b)}},b=m.extendManager(n,"groupManager",{create:function(){var b=Object.create(this);return a.call(b),b}});return b}(),p=function(){var a=function(){function a(a){var d=b[a.getUuid()];if(d){var e=c[d];e&&e.removeElement(a)}}var b=Object.create(null),c=Object.create(null);this.setPlayer=function(a,d){b[a.getUuid()]=d;var e=c[d];e||(e=x(),c[d]=e),e.add(a)},this.getEntitiesOfPlayer=function(a){var b=c[a];return b||(b=x(),c[a]=b),b},this.removeFromPlayer=a,this.getPlayer=function(a){return b[a.getUuid()]},this.deleted=function(b){a(b)}},b=m.extendManager(n,"playerManager",{create:function(){var b=Object.create(this);return a.call(b),b}});return b}(),q=function(){var a=function(){var a=Object.create(Object.prototype),b=Object.create(null);this.register=function(c,d){a[c]=d,b[d.getUuid()]=c},this.unregister=function(c){var d=a[c];delete a[c],delete b[d.getUuid()]},this.isRegistered=function(b){return a[b]?!0:!1},this.getEntity=function(b){return a[b]},this.getRegisteredTags=function(){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},this.deleted=function(c){var d=b[c.getUuid()];delete b[c.getUuid()],null!==d&&delete a[d]}},b=m.extendManager(n,"tagManager",{create:function(){var b=Object.create(this);return a.call(b),b}});return b}(),r=function(){var a=function(){function a(a){var d=c[a];if(delete c[a],!d){var e=b[d];e||e.removeElement(a)}}var b=Object.create(null),c=Object.create(null);this.getTeam=function(a){return c[a]},this.setTeam=function(d,e){a(d),c[d]=e;var f=b[e];f||(f=x(),b[e]=f),f.add(d)},this.getPlayers=function(a){return b[a]},this.removeFromTeam=a},b=m.extendManager(n,"managerType",{create:function(){var b=Object.create(this);return a.call(b),b}});return b}(),s=function(){var a=function(){var a=0,b=!1,c=0;this.restart=function(d){a=d,c=0,b=!0},this.offerDelay=function(a){(!b||a<this.getRemainingTimeUntilProcessing())&&this.restart(a)},this.getRemainingTimeUntilProcessing=function(){return b?a-c:0},this.stop=function(){b=!1,c=0},this.inserted=function(a){var b=this.getRemainingDelay(a);b>0&&this.offerDelay(b)},this.getInitialTimeDelay=function(){return a},this.isRunning=function(){return b},this.processEntities=function(a){for(var b,d,e=0;e<a.size();e++)b=a.get(e),this.processDelta(b,c),d=this.getRemainingDelay(b),0>=d?this.processExpired(b):this.offerDelay(d);c=0,0===a.size()&&this.stop()},this.checkProcessing=function(){return b&&(c+=this.getWorld().getDelta(),c>=a)?!0:!1}},b=m.extendSystem(l,"delayedEntityProcessingSystem",{create:function(b){var c=l.create.call(this,b);return a.call(c),c},getRemainingDelay:function(){throw{NotImplemented:"Not supported yet. Override getRemainingDelay when extending"}},processDelta:function(){throw{NotImplemented:"Not supported yet. Override processDelta when extending"}},processExpired:function(){throw{NotImplemented:"Not supported yet. Override processExpired when extending"}}});return b}(),t=m.extendSystem(l,"entityProcessingSystem",{create:function(a){var b=l.create.call(this,a);return b},processEntity:function(){throw{NotImplemented:"Not supported yet. Override process when extending"}},processEntities:function(a){for(var b=0;b<a.size();b++)this.processEntity(a.get(b))},checkProcessing:function(){return!0}}),u=m.extendSystem(t,"intervalEntityProcessingSystem",{create:function(a,b){var c=t.create.call(this,a);return c=v.create.call(c,a,b)}}),v=function(){var a=function(a){var b=0;this.checkProcessing=function(){return b+=this.getWorld().getDelta(),b>=a?(b-=a,!0):!1}},b=m.extendSystem(l,"intervalEntitySystem",{create:function(b,c){var d=l.create.call(this,b);return a.call(d,c),d}});return b}(),w=m.extendSystem(l,"voidEntitySystem",{create:function(){var a=l.create.call(this,c.getEmpty());return a},processSystem:function(){throw{NotImplemented:"Not supported yet. Override processSystem when extending"}},processEntities:function(){this.processSystem.call(this)},checkProcessing:function(){return!0}}),x=function(a){function b(a){a||(a=Math.ceil(3*c.length/2+1)),c.length=a}var c=[],d=0;c.length=a?a:64;var e=function(a){if(a>=d)return void 0;var b=c[a];return c[a]=c[--d],c[d]=null,b},f=function(){if(d>0){var a=c[--d];return c[d]=null,a}return null},g=function(a){for(var b,e=0;d>e;e++)if(b=c[e],a==b)return c[e]=c[--d],c[d]=null,!0;return!1},h=function(a){for(var b=0;d>b;b++)if(a==c[b])return!0;return!1},i=function(a){for(var b,f=!1,g=0;g<a.size();g++){b=a.get(g);for(var h=0;d>h;h++)if(b==c[h]){e(h),h--,f=!0;break}}return f},j=function(a){return c[a]},k=function(){return d},l=function(){return c.length},m=function(a){return a<l()},n=function(){return 0===d},o=function(a){d===c.length&&b(),c[d++]=a},p=function(a,e){a>=c.length&&b(2*a),a>d&&(d=a+1),c[a]=e},q=function(){for(var a=0;a<c.length;a++)c[a]=null;d=0},r=function(a){for(var b=0;b<a.size();b++)o(a.get(b))};return{add:o,addAll:r,removeByIndex:e,removeLast:f,removeElement:g,removeAll:i,clear:q,get:j,set:p,getCapacity:l,size:k,contains:h,isIndexWithinBounds:m,isEmpty:n}};Math.signum||(Math.signum=function(a){return"number"==typeof a?a?0>a?-1:1:a===a?0:0/0:0/0});var y={_sin_a:-4/this.SQUARED_PI,_sin_b:4/Math.PI,_sin_p:.225,_asin_a:-.048129527683101345,_asin_b:-.3438359939479152,_asin_c:.9627618484259132,_asin_d:1.0013894086010704,SQUARED_PI:Math.PI*Math.PI,HALF_PI:.5*Math.PI,TWO_PI:2*Math.PI,THREE_PI_HALVES:this.TWO_PI-this.HALF_PI,cos:function(a){return this.sin(a+(a>this.HALF_PI?-this.THREE_PI_HALVES:this.HALF_PI))},sin:function(a){return a=this._sin_a*a*Math.abs(a)+this._sin_b*a,this._sin_p*(a*Math.abs(a)-a)+a},tan:function(a){return sin(a)/cos(a)},asin:function(a){return a*(Math.abs(a)*(Math.abs(a)*this._asin_a+this._asin_b)+this._asin_c)+Math.signum(a)*(this._asin_d-Math.sqrt(1-a*a))},acos:function(a){return this.HALF_PI-this.asin(a)},atan:function(a){return Math.abs(a)<1?a/(1+this._atan_a*a*a):Math.signum(a)*this.HALF_PI-a/(a*a+this._atan_a)}},z={_delay:0,_repeat:!1,_acc:0,_done:!1,_stopped:!1,execute:null,create:function(a,b,c){var d=Object.create(this);return d._delay=a,"boolean"==typeof b&&(d._repeat=b),d.execute=c,d},update:function(a){this._done||this._stopped||(this._acc+=a,this._acc>=this._delay&&(this._acc-=this._delay,this._repeat?this.reset():this._done=!0,"function"==typeof this.execute&&this.execute()))},reset:function(){this._stopped=!1,this._done=!1,this._acc=0},isDone:function(){return this._done},isRunning:function(){return!this._done&&this._acc<this._delay&&!this._stopped},stop:function(){this._stopped=!0},setDelay:function(a){this._delay=a},getPercentageRemaining:function(){return this._done?100:this._stopped?0:1-(this._delay-this._acc)/this._delay},getDelay:function(){return this._delay}},A=function(){var a=function(){function a(a,b){if(a.__componentTypes){var c=a.__componentTypes;if("string"==typeof c&&(c=[c]),!Array.isArray(c)||0===c.length)return;for(var d,e=0;e<c.length;e++){d=c[e];var f=b.getMapper(d);Object.defineProperty(a,d+"Mapper",{value:f,configurable:!1,enumerable:!0,writable:!1})}}}function b(a,b,c){for(var d,e=0;e<a.size();e++)d=a.get(e),d[c]&&d[c].call(d,b)}function c(a,c){if(!a.isEmpty()){for(var d,e=0;e<a.size();e++)d=a.get(e),b(n,d,c),b(p,d,c);a.clear()}}var d=d.create(),e=e.create(),f=0,h=x(),i=x(),j=x(),k=x(),l=x(),m=Object.create(null),n=x(),o=Object.create(null),p=x();this.initialize=function(){for(var b,c=0;c<n.size();c++)b=n.get(c),b.initialize.call(b);var d;for(c=0;c<p.size();c++)d=p.get(c),a(d,this),d.initialize.call(d)},this.getEntityManager=function(){return d},this.getComponentManager=function(){return e},this.setManager=function(a){return m[a.managerType]=a,n.add(a),a.setWorld(this),a},this.getManager=function(a){return m[a]},this.deleteManager=function(a){delete m[a.managerType],n.removeElement(a)},this.getDelta=function(){return f},this.setDelta=function(a){f=a},this.addEntity=function(a){h.add(a)},this.changedEntity=function(a){i.add(a)},this.deleteEntity=function(a){j.contains(a)||j.add(a)},this.enable=function(a){k.add(a)},this.disable=function(a){l.add(a)},this.createEntity=function(){return d.createEntityInstance()},this.getEntity=function(a){return d.getEntity(a)},this.getSystems=function(){return p},this.setSystem=function(a,b){return a.setWorld(this),a.setPassive(b),o[a.systemType]=a,p.add(a),a},this.deleteSystem=function(a){delete o[a.systemType],p.removeElement(a)},this.getSystem=function(a){return o[a]},this.getMapper=function(a){return g.getFor(a,this)},this.process=function(){c(h,"added"),c(i,"changed"),c(l,"disabled"),c(k,"enabled"),c(j,"deleted"),e.clean();for(var a,b=0;b<p.size();b++)a=p.get(b),a.isPassive()||a.process.call(a)},this.setManager(d),this.setManager(e)},b=d.extend({create:function(){var b=Object.create(this);return a.call(b),b}});return b}(),B={bag:x,bitSet:a,fastMath:y,timer:z,world:A,manager:n,entity:i,entityManager:j,entityObserver:k,entitySystem:l,component:e,componentManager:f,Aspect:c,ComponentMapper:g,ComponentType:h,ExtendHelper:m,groupManager:o,playerManager:p,tagManager:q,teamManager:r,delayedEntityProcessingSystem:s,entityProcessingSystem:t,intervalEntitySystem:v,intervalEntityProcessingSystem:u,voidEntitySystem:w};return B});